---
title: "Funciones"
author: "Azahara Martinez"
date: "2025-12-14"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(seewave)
library(tuneR)
```


# PERIOD PITCH

El pitch es básicamente la frecuencia fundamental (vibración más baja, la base sobre la que se ocnstruyen el resto de vibraciones). 

La frecuencia fundamental es la más característica porque es la base estable de la voz, independientemente de si hablas más fuerte o más suave. Las vibraciones más altas (los armónicos) cambian con el tono o la intensidad, pero la fundamental te da la identidad básica de la voz.

Mide qué tan grave o qué tan aguda suena una voz. 
- Voz grave → pitch bajo (frecuencias bajas)
 -Voz aguda → pitch alto (frecuencias altas)

Se mide en Hz (vibraciones por segundo). 

Valores típicos:
- Hombres: más o menos 100–150 Hz
- Mujeres: más o menos 180–250 Hz

El period pitch se calcula estimando el periodo fundamental de la señal mediante autocorrelación. Este método permite detectar la periodicidad principal de la voz, a partir de la cual se obtiene la frecuencia fundamental, que está directamente relacionada con la percepción de la altura tonal de la voz. Solo funciona bien en partes sonoras (vocales).


```{r}
period_pitch <- function(signal, fs = NULL, fmin = 80, fmax = 300) {

  # --- Convertir Wave a vector numérico ---
  if (inherits(signal, "Wave")) {
    if (is.null(fs)) fs <- signal@samp.rate

    if (isTRUE(signal@stereo)) {
      x <- (as.numeric(signal@left) + as.numeric(signal@right)) / 2
    } else {
      x <- as.numeric(signal@left)
    }

    signal <- x
  } else {
    signal <- as.numeric(signal)
  }

  signal <- signal[is.finite(signal)]
  signal <- signal - mean(signal)

  n <- length(signal)
  if (n < 10) stop("La señal tiene muy pocas muestras.")

  # --- Lags según F0 esperado ---
  lag_min <- floor(fs / fmax)
  lag_max <- ceiling(fs / fmin)
  lag_max <- min(lag_max, n - 1)

  if (lag_min >= lag_max) stop("Señal demasiado corta para estimar pitch.")

  ac <- as.numeric(acf(signal, lag.max = lag_max, plot = FALSE)$acf)
  ac <- ac[-1]

  lag <- which.max(ac[lag_min:lag_max]) + lag_min - 1
  period <- lag / fs
  pitch <- 1 / period

  # --- Clasificación por pitch ---
  gender <- if (pitch < 160) {
    "Masculina"
  } else if (pitch > 180) {
    "Femenina"
  } else {
    "Indeterminado"
  }

  list(
    period = period,
    pitch = pitch,
    gender = gender,
    fs = fs,
    n = n
  )
}

```

```{r}
o1 <- readWave("Audioswav/Oscar a1.wav")
res <- period_pitch(o1)
res$pitch
res$gender

```
```{r}
a1 <- readWave("Audioswav/Aza a1.wav")
res <- period_pitch(a1)
res$pitch
res$gender

```
```{r}
i1 <- readWave("Audioswav/Iyan a1.wav")
res <- period_pitch(i1)
res$pitch
res$gender
```
```{r}
m1 <- readWave("Audioswav/MAngeles a1.wav")
res <- period_pitch(m1)
res$pitch
res$gender
```

```{r}
A1 <- readWave("Audioswav/alvaro a1.wav")
res <- period_pitch(A1)
res$pitch
res$gender
```
```{r}
f1 <- readWave("Audioswav/Flor a1.wav")
res <- period_pitch(f1)
res$pitch
res$gender
```
```{r}
ia1 <- readWave("Audioswav/Beatriz a1.wav")
res <- period_pitch(ia1)
res$pitch
res$gender
```

```{r}
en1 <- readWave("Audioswav/Enrique a1.wav")
res <- period_pitch(en1)
res$pitch
res$gender
```
